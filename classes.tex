\input functions

\def\@ifchar@cmp{%
    \ifx\@tpp@regA\@tpp@temp%
        \@tofi{\@tpp@regB}%
    \else%
        \@afterfi\@tpp@regC%
    \fi%
}

\def\@ifnextchar#1#2#3{\let\@tpp@regA=#1\relax \def\@tpp@regB{#2}\def\@tpp@regC{#3}\futurelet\@tpp@temp\@ifchar@cmp}

\def\@get@instance@name#1{%
    \ifx\@undefined#1 %
        \edef\tpp@class@name{\m@strip#1}%
    \else%
        #1?%
    \fi%
}

\def\@@@construct#1#2#3{%
    \expanded{\unexpanded{\csname \m@strip#1@contr\endcsname}{\csname #2\endcsname}\unexpanded{{#3}}}%
}

\def\@@construct#1#2.#3{%
    \let\old@tpp@class@name=\tpp@class@name%
    \@get@instance@name{#3}%
    \expanded{\unexpanded{\@construct{#1}}{\old@tpp@class@name::\tpp@class@name}}%
}

\def\@construct#1#2{%
    \@ifnextchar. {\@@construct{#1}{#2}}%
                  {\@@@construct{#1}{#2}}%
}

\def\class#1{%
    \@xp\let\csname \m@strip#1::\m@strip#1\endcsname=\@gobble%
    \@xp\def\csname \m@strip#1@contr\endcsname##1##2{%
        \def##1{%
            \@ifnextchar. {\@member@call{\m@strip#1}{\m@strip##1}}%
                          {%
                            \if?\@tpp@temp %
                                \@tofi{\edef\tpp@class@name{\m@strip##1}\@gobble}%
                            \else%
                                \@afterfi{%
                                    \unless\ifx\@tpp@temp\ %
                                        \@afterfi\@operator@call{\m@strip#1}{##1}%
                                    \fi%
                                }%
                            \fi}%
        }%
        \def\@tpp@temp{##2}%
        \ifx\@tpp@temp\empty %
            \csname \m@strip#1::\m@strip#1\endcsname{##1}%
        \else%
            \csname \m@strip#1::\m@strip#1\endcsname{##1,##2}%
        \fi%
    }%
    \def#1##1{\@get@instance@name{##1}\@construct{#1}{\tpp@class@name}}%
}

\def\@method@call#1#2#3#4{%
    \def\@tpp@temp{#4}%
    \ifx\empty\@tpp@temp %
        \csname #1::\m@strip#3\endcsname{#2}%
    \else%
        \csname #1::\m@strip#3\endcsname{#2,#4}%
    \fi%
}

\def\@member@call#1#2.#3{%
    \@ifnextchar\bgroup {\@method@call{#1}{\csname #2\endcsname}{#3}}%
                        {\csname #2::\m@strip#3\endcsname}%
}

\def\@operator@call#1#2#3#4{%
    \csname #1::#3\endcsname{#2,#4}%
}

\long\def\method#1::#2#3#4{%
    \@xp\function\csname \m@strip#1::\m@strip#2\endcsname{#3}{#4}%
}

\long\def\operator#1::#2#3#4{%
    \@xp\function\csname \m@strip#1::#2\endcsname{#3}{#4}%
}

\class\String
\method\String::\String{\self, \s}{%
    \@get@instance@name{\self}%
    \@xp\edef\csname \tpp@class@name @str\endcsname{\s}%
}

\method\String::\print{\self}{%
    \@get@instance@name{\self}%
    \csname \tpp@class@name @str\endcsname%
}

\class\Test
\method\Test::\test{Hello this is a test}

\class\Person
\method\Person::\Person{\self, \n}{\String\self.\name{\n}}
\method\Person::\eat{\self, \food}{I, \self.\name.\print{}\ like \food}
\method\Person::\foo{\self}{foo}

\Person\p{Slurp}
\p.\eat{pizza}

\end
